"0","# Step 1: Trim spaces and detect rows with titles and dates"
"0","cleaned_data <- extracted_lines |>"
"0","  mutate("
"0","    # Trim leading and trailing spaces before detection"
"0","    trimmed_line = str_trim(extracted_lines),  "
"0",""
"0","    # Detect titles (start with a number and a period)"
"0","    is_title = str_detect(trimmed_line, ""^\\d+\\. ""),  "
"0",""
"0","    # Detect dates (e.g., ""Aug 14, 2024"")"
"0","    is_date = str_detect(trimmed_line, ""\\b\\w{3} \\d{1,2}, \\d{4}\\b"")"
"0","  )"
"0",""
"0","# Step 2: Shift dates to align with corresponding titles"
"0","aligned_data <- cleaned_data |>"
"0","  mutate("
"0","    date = ifelse(lead(is_date, 1), lead(trimmed_line, 1), NA_character_)  # Shift date to title's row"
"0","  ) |>"
"0","  filter(is_title) |>"
"0","  select(trimmed_line, date)  # Keep only the relevant columns"
"0",""
"0","# Step 3: Rename columns for clarity"
"0","final_data <- aligned_data |>"
"0","  rename("
"0","    title = trimmed_line,"
"0","    date = date"
"0","  )"
"0",""
"0","#Step 4: Date and Publication in separate columns, and formatted"
"0","final_data <- separate(data = final_data, col = date, into = c(""date2"", ""publication""), sep = ""  "", extra = ""merge"", fill = ""right"")"
"0",""
"0",""
"0","#Step 5: Format date, clean headline"
"0","final_data <- final_data |> "
"0","  mutate(date = as.Date(date2,format = ""%b %d, %Y"")) |> "
"0","  mutate(title =str_remove(title, ""^\\d+\\. "")) |> "
"0","  subset(select = -(date2)) |> "
"0","  mutate(index = row_number()) |> "
"0","  select(index, date, title, publication)"
"0",""
"0","write_csv(final_data, ""final_data.csv"")"
"0","  "
