"0","# Step 1: Check dimensions"
"0","n_theta3 <- nrow(theta3)"
"0","n_textdata2 <- length(textdata2$year)"
"0",""
"0","cat(""Number of rows in theta: "", n_theta3, ""\n"")"
"1","Number of rows in theta: "
"1"," "
"1","1958"
"1"," "
"1","
"
"0","cat(""Number of documents in textdata: "", n_textdata2, ""\n"")"
"1","Number of documents in textdata: "
"1"," "
"1","1958"
"1"," "
"1","
"
"0","# Check if textdata contains all the documents in theta"
"0","common_ids3 <- intersect(rownames(theta3), textdata2$doc_id) "
"0",""
"0","# Filter textdata to include only the documents present in theta"
"0","textdata2_filtered <- textdata2[textdata2$doc_id %in% common_ids3, ]"
"0",""
"0","# Check dimensions after filtering"
"0","n_textdata2_filtered <- nrow(textdata2_filtered)"
"0","cat(""Number of documents in filtered textdata2: "", n_textdata2_filtered, ""\n"")"
"1","Number of documents in filtered textdata2: "
"1"," "
"1","1958"
"1"," "
"1","
"
"0","# Ensure the lengths match now"
"0","if (n_theta3 != n_textdata2_filtered) {"
"0","  stop(""The number of rows in 'theta' still does not match the length of 'textdata2_filtered$year'."")"
"0","}"
"0",""
"0","# Align rownames of theta with filtered textdata"
"0","theta_aligned3 <- theta3[rownames(theta3) %in% textdata2_filtered$doc_id, ]"
"0",""
"0","# Optional: Verify the order of documents"
"0","if (!all(rownames(theta_aligned3) == textdata2_filtered$doc_id)) {"
"0","  # If the order doesn't match, reorder one to match the other"
"0","  textdata2_filtered <- textdata2_filtered[match(rownames(theta_aligned3), textdata2_filtered$doc_id), ]"
"0","}"
"0",""
"0","# Ensure they are now aligned and can be combined"
"0","if (!all(rownames(theta_aligned3) == textdata2_filtered$doc_id)) {"
"0","  stop(""The document IDs still do not match. Please check the data alignment."")"
"0","}"
"0",""
"0","# Step 2: Combine data"
"0","topic_data3 <- data.frame(theta_aligned3, year = textdata2_filtered$year)"
"0",""
"0","# Step 3: Aggregate data"
"0","topic_proportion_per_year3 <- aggregate(. ~ year, data = topic_data3, FUN = mean)"
"0",""
"0",""
"0","# get mean topic proportions per decade"
"0","# topic_proportion_per_decade <- aggregate(theta, by = list(decade = textdata$decade), mean)"
"0","# set topic names to aggregated columns"
"0","colnames(topic_proportion_per_year3)[2:(K+1)] <- topicNames3"
"0","# reshape data frame"
"0","vizDataFrame3 <- melt(topic_proportion_per_year3, id.vars = ""year"")"
